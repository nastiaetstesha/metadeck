{% extends "base.html" %}
{% load static %}

{% block title %}Session{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'session/css/room.css' %}">
{% endblock %}

{% block content %}
<div class="session-room" data-session-room>
  <div class="topbar">
    <div class="title">
      <h1>Session</h1>
      <div class="sub">Mode: {{ session.get_mode_display }}</div>
    </div>

    <div class="right">
      <div id="wsStatus" class="pill">WS: connecting...</div>
      <a class="btn btn-secondary" href="{% url 'cards:home' %}">Home</a>
    </div>
  </div>

  {% if not is_client %}
    <div class="panel share">
      <h3>Share with client</h3>
      <div class="link">{{ client_link }}</div>
      <div class="link">Host link: {{ host_link }}</div>
      <div class="hint">Client won‚Äôt see deck title (you can keep it only on the deck selection screen).</div>
    </div>
  {% endif %}

  <div class="controls">
    <button class="btn" id="btnDraw1" type="button">Draw 1</button>
    <button class="btn" id="btnDraw3" type="button">Draw 3</button>
    <button class="btn" id="btnDraw6" type="button">Draw 6</button>
    <button class="btn btn-secondary" id="btnReset" type="button">Reset</button>
  </div>

  <div id="cardsGrid" class="grid" aria-live="polite">
    {% if drawn_cards %}
      {# —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ ‚Äú–ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É‚Äù, –Ω–æ –¥–∞–ª—å—à–µ –≤—Å—ë —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è JS #}
      {% for card in drawn_cards %}
        <div class="flip-wrap">
           <button class="zoom-open" type="button" data-zoom title="Preview">üîç</button>
        <div class="flip-card" data-flip>
            <div class="flip-face flip-front">
              {% if session.deck.back_full %}
                <img src="{{ session.deck.back_full.url }}" alt="back">
              {% else %}
                <div class="empty">No back image</div>
              {% endif %}
            </div>

            <div class="flip-face flip-back">
              {% if card.image_full %}
                <img src="{{ card.image_full.url }}" alt="card">
              {% else %}
                <div class="empty">No card image</div>
              {% endif %}
            </div>

            <!-- <button class="zoom-btn" type="button" data-zoom title="Zoom">+</button> -->
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="panel empty wide">
        No cards yet. Click ‚ÄúDraw 1‚Äù or ‚ÄúDraw 6‚Äù.
      </div>
    {% endif %}
  </div>

  <div class="hint below">
    Tip: click a card to flip it. (Flip is synced via WS now.)
    <br>
    Debug: add <code>?debug=1</code> to the URL to see back/front URLs under each card.
  </div>

  <!-- Zoom modal
  <div class="modal" id="zoomModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Card preview">
      <div class="modal-toolbar">
        <div class="modal-title">Preview</div>
        <div class="modal-actions">
          <button class="icon-btn" type="button" id="zoomOutBtn" title="Zoom out">‚àí</button>
          <button class="icon-btn" type="button" id="zoomInBtn" title="Zoom in">+</button>
          <button class="icon-btn" type="button" id="zoomCloseBtn" title="Close">√ó</button>
        </div>
      </div>
      <div class="modal-body">
        <img id="zoomImg" alt="zoomed card">
      </div>
    </div>
  </div> -->
    <!-- Zoom modal -->
  <div class="zoom-modal" id="zoomModal" aria-hidden="true">
    <div class="zoom-backdrop" data-zoom-close></div>

    <div class="zoom-card" role="dialog" aria-modal="true">
      <div class="zoom-toolbar">
        <div class="zoom-title">Preview</div>

        <div class="zoom-actions">
          <button class="zoom-btn" type="button" id="zoomOutBtn" title="Zoom out">‚àí</button>
          <button class="zoom-btn" type="button" id="zoomInBtn" title="Zoom in">+</button>
          <button class="zoom-btn" type="button" id="zoomCloseBtn" title="Close">‚úï</button>
        </div>
      </div>

      <div class="zoom-body">
        <img id="zoomImg" alt="zoomed card">
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  window.__SESSION_ID__ = "{{ session.id }}";
  window.__DEBUG__ = "{{ request.GET.debug|default:'0' }}" === "1";
</script>
<script defer src="{% static 'session/js/room.js' %}"></script>
{% endblock %}
